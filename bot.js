
/*****************************************************************************************						
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXd:'...,lONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMO,        .dNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNc          'OWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWo          ;KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMWWXOkkO0NMNd'      .:0WWX0kkOKNWMMMWWMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMWNXKOkoc,.    .:KMWXl    .kNWWx'    ..;ldk0KXWWMMMMMMMMMMMMMMMMMMMMM
W0dddddooooollllccc::;,'..            ,kXNd.   ,KNKd.           ...';;::ccclllooooodddddkX
WO,                                     .ld.   ;x;.                                    .lX
MWKd;....                                ;o.   ;o.                               ....':kNM
MMMMWXKK0c                               ;o.   ;o.                              .xK0KNWMMM
MMMMMMMMMXd:,''.                         :d.   ;o.                        .''',cOWMMMMMWMM
MMMMMMMMMMMWWNNK:                        :d.   :o.                       .dNNNWWMMMMMMMMMM
MMMMMMMMMMMMMMMMXx;....':dc.             ;d.   ;o.             'oo;....'cOWMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMWMWXK0KNWMNOc'.        ..lx.   ;x;.         .;oKWMWXK0KNWMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMWMMMMMWMMWN0kxdddxkO0KNx.   ;XNK0OxxddxxkKWMMMMMMMWWMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMN0xlc:;,,,;:lONMMk.   :XMMXxl:;;:::lox0NMMMMMWMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMNx;.            :KMk.   :XNx'           .,dXWWMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMNo      ..        cNk.   :Xk.               :KMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMM0'    .xK0d;.    .dNk.   :NO'     .:xOO;     dMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMK;    .cONMWKOkOOKWMO.   :NWXOxxxOXWWXx'    .xMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMWO'     .':ldO0KNWMM0c,,,dNMMWWXKOxl:.     .oNMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMM0c.        .:dOOkxollllllc:;,..         ,kWMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMW0o,.  .:odo:'.                     .ckNWMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMN0doxd,.                    ..;lkXWMMWMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWO;          ....'',,;:looooxKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMWO'      .;oxxolllkNWKd:;,..  cXMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMNc       cNWMO.   cNMWx.      .kWMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMX;       :XMM0'   cNMNd.      .kWMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMWo.       ;xKO;.,;xXk:.       :XMWWMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNd'     .,ck0dool:.        .oXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXx;':dxdl;.           .;dKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWMNOo;.          ..;coxXMWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKo.       .;::clllc;..cKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM0;      .lxdc:;lo'      ;0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWo      .xW0,   lWXc      lWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWd.      :K0,  .xWK:      oWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXo.    .'o0dllll;.      ;KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNOc';looc,..         .oXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWWWKd;.         .':cdXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMK:      .;:cc:::;':KWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWo     ,do:;,:'    .xMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNc     l0l;c::.    .kMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM0, .;cll:'..      cXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXxoc'          'oXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWd.     ..';::cc;oNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN:    ;l::cc,.   :XMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWO,  .oc,::'    ;0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXx:col,.. .'ckNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWMNOl,..';:::::oKWWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNOl;,:odl;,':oc,..:kNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKxd0NWMK,   lWMNXOxONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMX:   oMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWl  .xMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMd. '0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMO'.:XMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
******************************************************************************************/

//Poimandres needs a few modules to run
var Discord = require('discord.io');
var logger = require('winston');
var auth = require('./auth.json');
var ch = require('./books/mead-ch.json');
var emeraldtablet = require('./books/emeraldtablet.json');


// Configure logger settings
logger.remove(logger.transports.Console);
logger.add(new logger.transports.Console, {
  colorize: true
});
logger.level = 'debug';

// Initialize Discord Bot------ 
var bot = new Discord.Client({

  token: auth.token, //grab the authorisation token out of auth.json

  autorun: true

});
//------------------------------

//Display text in the log window to show the bot is online and connected.
bot.on('ready', function(evt) {
  logger.info('Connected');
  logger.info('Logged in as: ');
  logger.info(bot.username + ' - (' + bot.id + ')');
});
//-----------------------------


bot.on('message', function(user, userID, channelID, message, evt) { //First, Poimandres will listen for messages...
  // Store our output message here.
 var output = '';

  // We are looking for something like "?lookup CH 1.2"
  if (message.substring(0, 7) == '?lookup') { //...If the message starts with '?lookup'...
    var args = message.split(' '); 
    // Split cmd into bits. The first bit should be the initials of a book, the second the index into that book. For example, "CH 1.2"
    var bookName = args[1].toUpperCase();
    var bookPart = args[2];

    // Is this the Corpus Hermeticum? Cool, let's go!
    if (ch.alias == bookName) {
      if (undefined !== ch.contents[bookPart]) {
        output = '**CH' + bookPart + '** *' + ch.translator + '*\n>>> ' + ch.contents[bookPart].message;
      } else {
        ouput = '**Book section ' + bookPart + ' not found!**';
      }
	//Is it the Emerald Tablet?
    } else if (emeraldtablet.alias == bookName) {
	  if (undefined !== emeraldtablet.contents[bookPart]) {
        output = '**The Emerald Tablet** *' + emeraldtablet.translator + '*\n>>> ' + emeraldtablet.contents[bookPart].message;
      } else {
        ouput = 'Try `*?lookup Emerald Tablet*`';
      }
	} else if (bookName.substring(0, 7) == 'EMERALD'){
		ouput = 'Try `*?lookup Emerald Tablet*`';
		
	} else {
	 output = '**Book ' + bookName + ' not found!**';
    }
	
	//Poimandres then replies with message stored in 'output' var
	bot.sendMessage({
		to: channelID,
		message: output
	});
	
  } //else the message Poimandres heard didnt start with '?lookup'...

}); //end of Poimandres listening to messages
