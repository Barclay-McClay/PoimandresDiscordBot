
/*****************************************************************************************						
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXd:'...,lONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMO,        .dNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNc          'OWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWo          ;KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMWWXOkkO0NMNd'      .:0WWX0kkOKNWMMMWWMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMWNXKOkoc,.    .:KMWXl    .kNWWx'    ..;ldk0KXWWMMMMMMMMMMMMMMMMMMMMM
W0dddddooooollllccc::;,'..            ,kXNd.   ,KNKd.           ...';;::ccclllooooodddddkX
WO,                                     .ld.   ;x;.                                    .lX
MWKd;....                                ;o.   ;o.                               ....':kNM
MMMMWXKK0c                               ;o.   ;o.                              .xK0KNWMMM
MMMMMMMMMXd:,''.                         :d.   ;o.                        .''',cOWMMMMMWMM
MMMMMMMMMMMWWNNK:                        :d.   :o.                       .dNNNWWMMMMMMMMMM
MMMMMMMMMMMMMMMMXx;....':dc.             ;d.   ;o.             'oo;....'cOWMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMWMWXK0KNWMNOc'.        ..lx.   ;x;.         .;oKWMWXK0KNWMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMWMMMMMWMMWN0kxdddxkO0KNx.   ;XNK0OxxddxxkKWMMMMMMMWWMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMN0xlc:;,,,;:lONMMk.   :XMMXxl:;;:::lox0NMMMMMWMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMNx;.            :KMk.   :XNx'           .,dXWWMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMNo      ..        cNk.   :Xk.               :KMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMM0'    .xK0d;.    .dNk.   :NO'     .:xOO;     dMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMK;    .cONMWKOkOOKWMO.   :NWXOxxxOXWWXx'    .xMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMWO'     .':ldO0KNWMM0c,,,dNMMWWXKOxl:.     .oNMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMM0c.        .:dOOkxollllllc:;,..         ,kWMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMW0o,.  .:odo:'.                     .ckNWMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMN0doxd,.                    ..;lkXWMMWMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWO;          ....'',,;:looooxKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMWO'      .;oxxolllkNWKd:;,..  cXMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMNc       cNWMO.   cNMWx.      .kWMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMX;       :XMM0'   cNMNd.      .kWMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMWo.       ;xKO;.,;xXk:.       :XMWWMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNd'     .,ck0dool:.        .oXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXx;':dxdl;.           .;dKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWMNOo;.          ..;coxXMWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKo.       .;::clllc;..cKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM0;      .lxdc:;lo'      ;0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWo      .xW0,   lWXc      lWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWd.      :K0,  .xWK:      oWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXo.    .'o0dllll;.      ;KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNOc';looc,..         .oXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWWWKd;.         .':cdXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMK:      .;:cc:::;':KWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWo     ,do:;,:'    .xMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNc     l0l;c::.    .kMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM0, .;cll:'..      cXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXxoc'          'oXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWd.     ..';::cc;oNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN:    ;l::cc,.   :XMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWO,  .oc,::'    ;0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXx:col,.. .'ckNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWMNOl,..';:::::oKWWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNOl;,:odl;,':oc,..:kNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKxd0NWMK,   lWMNXOxONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMX:   oMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWl  .xMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMd. '0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMO'.:XMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
******************************************************************************************/

//Poimandres needs a few modules to run
var Discord = require('discord.io');
var logger = require('winston');
const auth = require('./auth.json');
const ch = require('./books/mead-ch.json');
const emeraldtablet = require('./books/emeraldtablet.json');
const kjBible = require('./books/king-james-bible.json');

// Configure logger settings
logger.remove(logger.transports.Console);
logger.add(new logger.transports.Console, {
  colorize: true
});
logger.level = 'debug';

// Initialize Discord Bot------ 
var bot = new Discord.Client({

  token: auth.token, //grab the authorisation token out of auth.json

  autorun: true

});
//------------------------------

//Display text in the log window to show the bot is online and connected.
bot.on('ready', function(evt) {
  logger.info('Connected');
  logger.info('Logged in as: ');
  logger.info(bot.username + ' - (' + bot.id + ')');
});
//-----------------------------


bot.on('message', function(user, userID, channelID, message, evt) { //First, Poimandres will listen for messages...
  var output = '';  // Store our output message here.
  var messageRaw = message.toUpperCase(); //force message to uppercase for easy comparison
if (messageRaw.substring(0,1) == '?') { //We are looking at a message beginning with '?'

    logger.info('INPUT: '+ message); //send it to the logger
	var cmd = messageRaw.substring(1); //remove the ?
	cmd = cmd.replace(':','.'); //replace semicolons with periods
	var args = cmd.split(' '); //split the command into its seperate arguments
    var bookPart = args[1]; //
	
   //HERMETICA--------------------------------
	// We are looking for something like "?CH 1.2"
	if (args[0] == 'CH') { //...If the message starts with '?CH'...
    if (undefined !== ch.contents[bookPart]) {
        output = '**CH ' + bookPart + '** *' + ch.translator + '*\n>>> ' + ch.contents[bookPart].message;
      }
	  if (output == ''){
        ouput = '**Book section ' + bookPart + ' not found!**';
      }

	//Is it the Emerald Tablet
	}else if (args[0] == 'EMERALD') {
	  logger.info('INPUT: '+ message);
	  output = '**The Emerald Tablet** *' + emeraldtablet.translator + '*\n>>> ' + emeraldtablet.message;

	  //---------------------------------------------
	//BIBLE BOOKS----------------------------
	} else if (undefined !== kjBible[args[0]]) { //we have a bible book under that name
		if (undefined !== kjBible[args[0]][bookPart]){
			var book = kjBible[args[0]][bookPart].message;
			output = '>>> '+book;
		}else{
			ouput = '**'+args[0]+' ' + bookPart + ' not found!**';
		}
	} //---------------------------------------------
	 
	//Poimandres then replies with message stored in 'output' var
	bot.sendMessage({
		to: channelID,
		message: output
	});
	 
	if (output !== '') {//logger for debug--
		logger.info('OUTPUT: '+output);
	}//--
	 
}//else the message Poimandres heard didnt start with a '?' command
}); //end of Poimandres listening to messages
